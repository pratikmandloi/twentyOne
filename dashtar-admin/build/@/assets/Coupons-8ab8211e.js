import{r as j,S as Z,W as ae,j as e,A as x,y as a,x as le}from"./index-4e201d1a.js";import{L as F,o as te,y as re,d as $,l as ne,U as ie,N as H,D as de,e as J,u as K,w as ce,f as Q,M as X,s as z,g as oe,P as me,i as xe,j as ge,k as ue,T as he}from"./Layout-7b360987.js";import{u as pe}from"./useFilter-1663f56c.js";import{S as je,C as ee,B as be}from"./BulkActionDrawer-7e43914e.js";import{u as fe,n as Y,b as q,L as A,E as k}from"./AdminServices-04341510.js";import{I as G}from"./InputArea-1751f9c9.js";import{d as R}from"./dayjs.min-8238a389.js";import{s as W}from"./dateFormate-5f63f880.js";import{E as ye}from"./EditDeleteButton-4abd9477.js";import{N as Ce}from"./NotFound-40b6c8ae.js";import{U as Te}from"./UploadManyTwo-dcece95f.js";import"./iconBase-c8e09bc7.js";import"./xlsx-04f2268f.js";const we=m=>{const{isDrawerOpen:t,closeDrawer:i,setIsUpdate:p,lang:r}=j.useContext(Z),[f,w]=j.useState(""),[d,b]=j.useState(r),[y,l]=j.useState({}),[v,S]=j.useState(!1),[s,u]=j.useState(!1),[C,h]=j.useState(!1),P=ae(c=>c.setting),{settingItem:I}=P,D=I.find(c=>c.name==="globalSetting"),U=(D==null?void 0:D.default_currency)||"$",{register:_,handleSubmit:M,setValue:o,clearErrors:N,formState:{errors:V}}=fe(),g=async c=>{var E,B;try{h(!0);const T=await te(c.title,d),n={title:{[d]:c.title,...T},couponCode:c.couponCode,endTime:c.endTime,minimumAmount:c.minimumAmount,logo:f,lang:d,status:v?"show":"hide",discountType:{type:s?"percentage":"fixed",value:c.discountPercentage},productType:c.productType};if(m){const O=await F.updateCoupon(m,n);p(!0),h(!1),q(O.message),i()}else{const O=await F.addCoupon(n);p(!0),h(!1),q(O.message),i()}}catch(T){Y(T?(B=(E=T==null?void 0:T.response)==null?void 0:E.data)==null?void 0:B.message:T.message),h(!1),i()}},L=c=>{b(c),Object.keys(y).length>0&&o("title",y.title[c||"en"])};return j.useEffect(()=>{if(!t){l({}),o("title"),o("productType"),o("couponCode"),o("endTime"),o("discountPercentage"),o("minimumAmount"),w(""),N("title"),N("productType"),N("couponCode"),N("endTime"),N("discountPercentage"),N("minimumAmount"),b(r),o("language",d);return}m&&(async()=>{var c,E,B,T;try{const n=await F.getCouponById(m);n&&(l(n),o("title",n.title[d||"en"]),o("productType",n.productType),o("couponCode",n.couponCode),o("endTime",R(n.endTime).format("YYYY-MM-DD HH:mm")),o("discountPercentage",(c=n.discountType)==null?void 0:c.value),o("minimumAmount",n.minimumAmount),S(n.status==="show"),u(((E=n.discountType)==null?void 0:E.type)==="percentage"),w(n.logo))}catch(n){Y(n?(T=(B=n==null?void 0:n.response)==null?void 0:B.data)==null?void 0:T.message:n.message)}})()},[m,o,t,N,d,r]),{register:_,handleSubmit:M,onSubmit:g,errors:V,setImageUrl:w,imageUrl:f,published:v,setPublished:S,currency:U,discountType:s,isSubmitting:C,setDiscountType:u,handleSelectLanguage:L}},Ne=({title:m,handleProcess:t,processOption:i,product:p,handleIsCombination:r})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:`${p?"mb-3 flex flex-wrap justify-end items-center mr-8":"mb-3"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[p?e.jsx("label",{className:"block text-base font-normal text-orange-500 dark:text-orange-400 mx-4",children:"Does this product have variants?"}):e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:m}),e.jsx(re,{onChange:p?r:t,checked:i,className:"react-switch",uncheckedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingRight:45,paddingTop:1},children:"Fixed"}),width:125,height:33,handleDiameter:28,offColor:"#E53E3E",onColor:"#2F855A",checkedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingLeft:50,paddingTop:1},children:"Percentage"})})]})})}),se=({id:m})=>{const{register:t,handleSubmit:i,onSubmit:p,errors:r,setImageUrl:f,imageUrl:w,published:d,setPublished:b,currency:y,discountType:l,setDiscountType:v,isSubmitting:S,handleSelectLanguage:s}=we(m);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative  p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 ",children:m?e.jsx($,{register:t,handleSelectLanguage:s,title:x("UpdateCoupon"),description:x("UpdateCouponDescription")}):e.jsx($,{register:t,handleSelectLanguage:s,title:x("AddCoupon"),description:x("AddCouponDescription")})}),e.jsx(ne.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:i(p),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("CouponBannerImage")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ie,{imageUrl:w,setImageUrl:f,folder:"coupon"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("CampaignName")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(G,{register:t,label:"Coupon title",name:"title",type:"text",placeholder:x("CampaignName")}),e.jsx(k,{errorName:r.title})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("CampaignCode")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(G,{register:t,label:"Coupon Code",name:"couponCode",type:"text",placeholder:x("CampaignCode")}),e.jsx(k,{errorName:r.couponCode})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("CouponValidityTime")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(a.Input,{...t("endTime",{required:"Coupon Validation End Time"}),label:"Coupon Validation End Time",name:"endTime",type:"datetime-local",placeholder:x("CouponValidityTime"),className:"border h-12 text-sm focus:outline-none block w-full bg-gray-100 dark:bg-white border-transparent focus:bg-white"}),e.jsx(k,{errorName:r.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("DiscountType")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(Ne,{handleProcess:v,processOption:l}),e.jsx(k,{errorName:r.discountType})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("Discount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{product:!0,register:t,maxValue:l?99:1e3,minValue:1,label:"Discount",name:"discountPercentage",type:"number",placeholder:l?"Percentage":"Fixed Amount",currency:l?"%":y}),e.jsx(k,{errorName:r.discountPercentage})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("MinimumAmount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(H,{product:!0,register:t,maxValue:2e5,minValue:100,label:"Minimum Amount",name:"minimumAmount",type:"number",placeholder:x("MinimumAmountPlasholder"),currency:y}),e.jsx(k,{errorName:r.minimumAmount})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(A,{label:x("Published")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(je,{handleProcess:b,processOption:d}),e.jsx(k,{errorName:r.productType})]})]})]}),e.jsx(de,{id:m,title:"Coupon",isSubmitting:S})]})})]})},ve=({lang:m,isCheck:t,coupons:i,setIsCheck:p})=>{const[r,f]=j.useState([]),{title:w,serviceId:d,handleModalOpen:b,handleUpdate:y}=J(),{data:l}=K(ce.getGlobalSetting),v=s=>{const{id:u,checked:C}=s.target;p([...t,u]),C||p(t.filter(h=>h!==u))},S=(l==null?void 0:l.default_currency)||"$";return j.useEffect(()=>{const s=i==null?void 0:i.map(u=>{const C=new Date(u==null?void 0:u.updatedAt).toLocaleString("en-US",{timeZone:l==null?void 0:l.default_time_zone});return{...u,updatedDate:C}});f(s)},[i,l==null?void 0:l.default_time_zone]),e.jsxs(e.Fragment,{children:[t.length<1&&e.jsx(Q,{id:d,title:w}),t.length<2&&e.jsx(X,{children:e.jsx(se,{id:d})}),e.jsx(a.TableBody,{children:r==null?void 0:r.map((s,u)=>{var C,h,P,I,D;return e.jsxs(a.TableRow,{children:[e.jsx(a.TableCell,{children:e.jsx(ee,{type:"checkbox",name:(C=s==null?void 0:s.title)==null?void 0:C.en,id:s._id,handleClick:v,isChecked:t==null?void 0:t.includes(s._id)})}),e.jsxs(a.TableCell,{children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.logo?e.jsx(a.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:s==null?void 0:s.logo,alt:"product"}):e.jsx(a.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:z(s==null?void 0:s.title,m)})," "]})]})," "]}),e.jsxs(a.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm",children:[" ",s.couponCode]})," "]}),(h=s==null?void 0:s.discountType)!=null&&h.type?e.jsxs(a.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold",children:[" ",((P=s==null?void 0:s.discountType)==null?void 0:P.type)==="percentage"?`${(I=s==null?void 0:s.discountType)==null?void 0:I.value}%`:`${S}${(D=s==null?void 0:s.discountType)==null?void 0:D.value}`]})," "]}):e.jsxs(a.TableCell,{children:[" ",e.jsx("span",{className:"text-sm font-semibold",children:" "})," "]}),e.jsx(a.TableCell,{className:"text-center",children:e.jsx(oe,{id:s._id,status:s.status})}),e.jsx(a.TableCell,{children:e.jsx("span",{className:"text-sm",children:W(s.startTime,l==null?void 0:l.default_date_format)})}),e.jsx(a.TableCell,{children:e.jsx("span",{className:"text-sm",children:W(s.endTime,l==null?void 0:l.default_date_format)})}),e.jsx(a.TableCell,{className:"align-middle ",children:R().isAfter(R(s.endTime))?e.jsx(a.Badge,{type:"danger",children:"Expired"}):e.jsx(a.Badge,{type:"success",children:"Active"})}),e.jsx(a.TableCell,{children:e.jsx(ye,{id:s==null?void 0:s._id,isCheck:t,handleUpdate:y,handleModalOpen:b,title:z(s==null?void 0:s.title,m)})})]},u+1)})})]})},Le=()=>{const{toggleDrawer:m,lang:t}=j.useContext(Z),{data:i,loading:p,error:r}=K(F.getAllCoupons),[f,w]=j.useState(!1),[d,b]=j.useState([]),{allId:y,serviceId:l,handleDeleteMany:v,handleUpdateMany:S}=J(),{handleSubmitCoupon:s,couponRef:u,dataTable:C,serviceData:h,totalResults:P,resultsPerPage:I,handleChangePage:D,handleSelectFile:U,filename:_,isDisabled:M,handleUploadMultiple:o,handleRemoveSelectFile:N}=pe(i),V=()=>{w(!f),b(i==null?void 0:i.map(L=>L._id)),f&&b([])},{t:g}=le();return e.jsxs(e.Fragment,{children:[e.jsx(me,{children:g("CouponspageTitle")}),e.jsx(Q,{ids:y,setIsCheck:b,title:"Selected Coupon"}),e.jsx(be,{ids:y,title:"Coupons"}),e.jsx(X,{children:e.jsx(se,{id:l})}),e.jsx(a.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(a.CardBody,{children:e.jsxs("form",{onSubmit:s,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6  xl:flex",children:[e.jsx("div",{className:"flex justify-start xl:w-1/2  md:w-full",children:e.jsx(Te,{title:"Coupon",exportData:i,filename:_,isDisabled:M,handleSelectFile:U,handleUploadMultiple:o,handleRemoveSelectFile:N})}),e.jsxs("div",{className:"lg:flex  md:flex xl:justify-end xl:w-1/2  md:w-full md:justify-start flex-grow-0",children:[e.jsx("div",{className:"w-full md:w-40 lg:w-40 xl:w-40 mr-3 mb-3 lg:mb-0",children:e.jsxs(a.Button,{disabled:d.length<1,onClick:()=>S(d),className:"w-full rounded-md h-12 btn-gray text-gray-600",children:[e.jsx("span",{className:"mr-2",children:e.jsx(xe,{})}),g("BulkAction")]})}),e.jsx("div",{className:"w-full md:w-32 lg:w-32 xl:w-32 mr-3 mb-3 lg:mb-0",children:e.jsxs(a.Button,{disabled:d.length<1,onClick:()=>v(d),className:"w-full rounded-md h-12 bg-red-500 btn-red",children:[e.jsx("span",{className:"mr-2",children:e.jsx(ge,{})}),g("Delete")]})}),e.jsx("div",{className:"w-full md:w-48 lg:w-48 xl:w-48",children:e.jsxs(a.Button,{onClick:m,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(ue,{})}),g("AddCouponsBtn")]})})]})]})})}),e.jsx(a.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(a.CardBody,{children:e.jsx("form",{onSubmit:s,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(a.Input,{ref:u,type:"search",className:"border h-12 text-sm focus:outline-none block w-full bg-gray-100 border-transparent focus:bg-white",placeholder:g("SearchCoupon")})})})})}),p?e.jsx(he,{row:12,col:8,width:140,height:20}):r?e.jsx("span",{className:"text-center mx-auto text-red-500",children:r}):(h==null?void 0:h.length)!==0?e.jsxs(a.TableContainer,{className:"mb-8",children:[e.jsxs(a.Table,{children:[e.jsx(a.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(a.TableCell,{children:e.jsx(ee,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:V,isChecked:f})}),e.jsx(a.TableCell,{children:g("CoupTblCampaignsName")}),e.jsx(a.TableCell,{children:g("CoupTblCode")}),e.jsx(a.TableCell,{children:g("Discount")}),e.jsx(a.TableCell,{className:"text-center",children:g("catPublishedTbl")}),e.jsx(a.TableCell,{children:g("CoupTblStartDate")}),e.jsx(a.TableCell,{children:g("CoupTblEndDate")}),e.jsx(a.TableCell,{children:g("CoupTblStatus")}),e.jsx(a.TableCell,{className:"text-right",children:g("CoupTblActions")})]})}),e.jsx(ve,{lang:t,isCheck:d,coupons:C,setIsCheck:b})]}),e.jsx(a.TableFooter,{children:e.jsx(a.Pagination,{totalResults:P,resultsPerPage:I,onChange:D,label:"Table navigation"})})]}):e.jsx(Ce,{title:"Sorry, There are no coupons right now."})]})};export{Le as default};
